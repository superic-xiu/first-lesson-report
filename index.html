<!DOCTYPE html>

<html lang="zh-CN">
<head>
<meta charset="utf-8"/>
<title>首次课学情诊断报告</title>
<style>
        @page {
            size: A4;
            margin: 15mm;
        }

        @font-face {
            font-family: 'MyCustomFont';
            src: url('./title.ttc') format('truetype');
            font-weight: normal;
            font-style: normal;
            color:#333
        }

        body {
            margin: 0 auto;
            width: 210mm;
            min-height: 290mm;
            font-family: 'MyCustomFont', sans-serif;
            color: #333;
            background: white;
            padding: 5mm 0mm;
            box-sizing: border-box;
        }
        .header {
            position: relative;
            width: 100%;
            background: #d7e9f8;
            overflow: hidden;
            height: 120px;
        }
        .footer-header {
            position: relative;
            width: 100%;
            background: #d7e9f8;
            overflow: hidden;
            height: 60px;
        }
        .header .left-shape, .footer-header .left-shape {
            position: absolute;
            left: 0;
            top: 20%;
            width: 75%;
            height: 60%;
            background: #1a2942;
            clip-path: polygon(0 0, 100% 0, 90% 100%, 0 100%);
        }
        .header .right-shape, .footer-header .right-shape {
            position: absolute;
            right: 0;
            top: 20%;
            width: 25%;
            height: 60%;
            background: #00a0e9;
            clip-path: polygon(31% 0, 100% 0, 100% 100%, 0 100%);
        }
        .header-content {
            position: relative;
            z-index: 1;
            padding: 25px 0 0 40px;
            color: white;
        }
        .footer-content {
            position: relative;
            z-index: 1;
            padding: 20px 0 0 40px;
            color: white;
        }
        .header h1 {
            margin: 0;
            font-size: 32px;
            font-weight: normal;
            letter-spacing: 1px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .header h1 .title-part, .footer-header h1 .title-part {
            display: inline-block;
        }
        .header h1 .title-part:first-child {
            font-size: 32px;
        }
        .header h1 .title-part:nth-child(2) {
            color: #25aae1;
        }
        .footer-header .title-part {
            font-size: 12px;
            letter-spacing: 3px;
        }
        .footer-header .title-part:first-child {
            color: #25aae1;
            margin-right: 8px;
        }
       
        .header .subtitle {
            display: flex;
            align-items: center;
            font-size: 9px;
            color: #ffffff;
            text-transform: uppercase;
            letter-spacing: 2px;
            padding-left: 8px;
            font-weight: 300;
        }
        .subtitle i {
            background-color: #23a2d8;
    display: inline-block;
    width: 20px;
    margin-right: 10px;
    height: 2px;
    vertical-align: middle;
        }
        .content {
            box-shadow: #ccc 0 0 10px;
            padding: 0 1px;
        } 
        .content-body {
            padding: 0 20px;
        }

        .container {
            background: white;
        }

        .container p {
            font-size: 10pt;
            color: #ccc;
        }

        h1 {
            text-align: center;
            font-size: 20pt;
            margin: 0 0 3mm;
            position: relative;
        }

        h2 {
            font-size: 16pt;
            margin: 4mm 0;
            background: #1a2942;
            color: white;
            padding: 8px 20px;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        h2::before {
            content: '';
    position: absolute;
    left: 0;
    top: 50%;
    transform: translateY(-50%);
    width: 13px;
    height: 100%;
    background: #25aae1;
        }
        h2 .en-title {
            font-family: 'MyCustomFont';
            src: url('./en_title.otf') format('truetype');
            color: #fff;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: normal;
        }

        .base-block,
        .exam-block,
        .guess-block {
            margin-bottom: 4mm;
        }
        .content p {
            font-size: 8pt;
            color: #ccc;
            margin-left: 8%;
        }

        .input-group {
            margin-bottom: 2mm;
            display: flex;
            align-items: center;
        }

        .base-block {
            display: grid;
            grid-template-columns: 33.3% 103.7%;
            grid-template-rows: 28pt 28pt 28pt;
            grid-auto-flow: column;
        }

       

        .base-block label {

            font-size: 12pt;
            vertical-align: middle;
            padding: 1mm 0;
        }

        .base-block input {
            margin-left: 5pt;
            width: 54%;
            padding: 1mm;
            border:none;
            font-size: 10.5pt;
            background: #d7e9f8;
            vertical-align: middle;
        }

        .exam-block {
            display: grid;
            grid-template-columns: repeat(3, minmax(0, 1fr));
            gap: 15px;
        }
        .exam-block .input-group {
            display: flex;
        }
        .exam-block label {
            width: 70px;
            font-size: 12pt;
        }
        .exam-block input,
        .exam-block select {
            flex: 1;
            background: #d7e9f8;
            border: none;
            padding: 6px;
            font-size: 10.5pt;
        }
        .exam-block .item3 {
            gap: 10px;
    margin-top: 10px;
    grid-column-start: 2;
    grid-column-end: 4;
        }
        .exam-block .item3 label {
            width: auto;
        }
        .exam-block .item3 input {
           
            background: #d7e9f8;
            border: none;
            padding: 6px;
            font-size: 10.5pt;
        }


        .guess-block {
            display: flex;
        }

        .guess-block .left {
            display: grid;
            width: 50%;
            margin-left: 40pt;
            margin-top: 20pt;

        }

         .study-block {
           display: grid;
           grid-template-columns: repeat(2,50%);
         }
         .study-block input {
            margin-left: 10pt;
            width: 55%;
         }
    
        .study-block .item3 {
            grid-column-start: 1;
            grid-column-end: 3;
            grid-row-start: 2;
            grid-row-end: 2;
        }         
 
        .study-block .item3 textarea {
    margin-left: 15pt;
    width: 71.5%;
    height: 28pt;
    resize: none;
    padding: 2pt 4pt;
}

        input, select, textarea {
            padding: 1mm;
            border:none;
            font-size: 10.5pt;
            background: #d7e9f8;
            vertical-align: middle;
        }


        .ability-section {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 4mm;
        }

        .ability-ratings {
            width: 45%;
        }

        .ability-chart {
            width: 55%;
            height: auto;
            aspect-ratio: 1;
        }

        .star-rating {
            display: inline-block;
            margin-left: 10mm;
        }

        .star {
            color: #d5cfc4;
            font-size: 12pt;
            cursor: pointer;
        }

        .star.active {
            color: #abd0e3;
        }

        canvas {
            max-width: 100%;
            height: auto;
        }

        @media print {
            body {
                padding: 0;
                margin: 15mm;
            }

            .base-block,
            .exam-block,
            .guess-block,
            .study-block {
                break-inside: avoid;
                background: #d7e9f8;
            }

            input,
            select,
            textarea {
                background-color: #d7e9f8;
                border:none;
            }
        }

        .study-block .item1,
        .study-block .item2 {
            margin-left: 20pt; /* 向右移动 */
        }


        .study-block .item3 label {
            margin-left: 20pt;
            display: inline-block;
            width: auto;
        }
        .study-block .item1 {
        width: 100%;
        }
        .study-block .item2 {
        width: 119%;
        }
        .study-block .item3 {
        width: 108%;
       
        }

        .study-block .item1 input {
            margin-left: 15pt; /* 默认是10pt，现在加5pt */
        }

        .exam-block input[type="number"],.exam-block input[type="text"] {
            width: 40%; /* 默认60%，现在缩小 */
        }


        .study-block .item3 textarea {
            margin-left: 15pt;
            width: 50%;
            height: 28pt;
            resize: none;
            padding: 2pt 4pt;
        }


        .study-block .item3 textarea {
    margin-left: 15pt;
    width: 71.5%;
    height: 28pt;
    resize: none;
    padding: 2pt 4pt;
}

    
@media screen and (max-width: 768px) {
    body {
        width: auto;
        padding: 10px;
    }

    .base-block,
    .exam-block,
    .guess-block,
    .study-block {
        display: block;
        width: 100%;
        box-sizing: border-box;
    }

    .base-block .input-group,
    .exam-block .input-group,
    .study-block .input-group {
        display: block;
        width: 100%;
        margin-left: 0;
        margin-bottom: 12px;
        height: auto;
    }

    .base-block input,
    .exam-block input,
    .exam-block select,
    .study-block input,
    .study-block textarea {
        width: 90% !important;
        margin-left: 0 !important;
    }

    .guess-block {
        flex-direction: column;
    }

    .guess-block .left,
    .guess-block .right {
        width: 100%;
        margin-left: 0;
        margin-top: 0;
    }

    canvas {
        width: 100% !important;
        height: auto !important;
    }

    button {
        position: static !important;
        margin: 10px auto;
        display: block;
    }
}

</style>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
   <div class="content">
    <div class="header">
        <div class="left-shape"></div>
        <div class="right-shape"></div>
        <div class="header-content">
            <h1><span class="title-part">首次课</span><span class="title-part">学情诊断报告</span></h1>
            <div class="subtitle"><i></i>DIAGNOSIS REPORT ON LEARNING SITUATION</div>
        </div>
    </div>
<button onclick="exportToImage('png')" style="position: fixed; top: 20px; right: 20px; z-index: 9999; padding: 8px 16px; font-size: 12pt;">一键导出图片</button>

<div class="content-body">
    <div class="container">

        <!-- 基本信息 -->
        <h2>基本信息 <span class="en-title">BASIC INFORMATION</span></h2>
        <div class="base-block">
            <div class="input-group">
                <label>学生姓名</label>
                <input required="" type="text"/>
            </div>
            <div class="input-group">
                <label>授课教师</label>
                <input required="" type="text"/>
            </div>
            <div class="input-group">
                <label>授课日期</label>
                <input required="" type="date"/>
            </div>
            <div class="input-group">
                <label>授课内容</label>
                <input placeholder="简明概括课程内容" type="text"/>
            </div>
            <div class="input-group">
                <label>重点难点</label>
                <input type="text"/>
            </div>
            <div class="input-group">
                <label>课后练习</label>
                <input type="text"/>
            </div>
        </div>
        <!-- 考试信息 -->
        <h2>考试信息 <span class="en-title">EXAM INFORMATION</span></h2>
        <div class="exam-block">
        <div class="input-group">
            <label>体系</label>
            <select required=""><option value="">请选择</option></select>
        </div>
        <div class="input-group item1">
            <label>学科</label>
            <select required=""><option value="">请选择</option></select>
        </div>
        <div class="input-group item2">
            <label>试卷</label>
            <select required=""><option value="">请选择</option></select>
        </div>
        <div class="input-group">
            <label>考试时长</label>
            <input placeholder="分钟" type="text"/>
        </div>
        <div class="input-group">
            <label>考试时间</label>
            <input required="" type="date"/>
        </div>
        <div class="input-group">
            <label>考试总分</label>
            <input type="number"/>
        </div>
        <div class="input-group">
            <label>目标等级</label>
            <input type="number"/>
        </div>

        <div class="input-group item3">
            <label class="item4">最新分数线标准</label>
            <input class="mini-input" placeholder="A*" type="text"/>
            <input class="mini-input" placeholder="A" type="text"/>
            <input class="mini-input" placeholder="B" type="text"/>
            <input class="mini-input" placeholder="C" type="text"/>
            <input class="mini-input" placeholder="D" type="text">
            </input>
        </div>
    </div>
        <!-- 能力评估 -->
        <h2>能力评估<span class="en-title">CAPABILITY ASSESSMENT</span></h2>
        <div class="guess-block">
        <div class="left">
        <div class="ability-item">
        <label>
                                学科基础
                            </label>
        <div class="star-rating" data-target="subject-base">
        <span class="star" data-value="1">
                                    ★
                                </span>
        <span class="star" data-value="2">
                                    ★
                                </span>
        <span class="star" data-value="3">
                                    ★
                                </span>
        <span class="star" data-value="4">
                                    ★
                                </span>
        <span class="star" data-value="5">
                                    ★
                                </span>
        </div>
        </div>
        <div class="ability-item">
        <label>
        英文水平
                            </label>
        <div class="star-rating" data-target="english">
        <span class="star" data-value="1">
                                    ★
                                </span>
        <span class="star" data-value="2">
                                    ★
                                </span>
        <span class="star" data-value="3">
                                    ★
                                </span>
        <span class="star" data-value="4">
                                    ★
                                </span>
        <span class="star" data-value="5">
                                    ★
                                </span>
        </div>
        </div>
        <div class="ability-item">
        <label>
                                计算准确
                            </label>
        <div class="star-rating" data-target="calculation">
        <span class="star" data-value="1">
                                    ★
                                </span>
        <span class="star" data-value="2">
                                    ★
                                </span>
        <span class="star" data-value="3">
                                    ★
                                </span>
        <span class="star" data-value="4">
                                    ★
                                </span>
        <span class="star" data-value="5">
                                    ★
                                </span>
        </div>
        </div>
        <div class="ability-item">
        <label>
                                灵活运用
                            </label>
        <div class="star-rating" data-target="flexibility">
        <span class="star" data-value="1">
                                    ★
                                </span>
        <span class="star" data-value="2">
                                    ★
                                </span>
        <span class="star" data-value="3">
                                    ★
                                </span>
        <span class="star" data-value="4">
                                    ★
                                </span>
        <span class="star" data-value="5">
                                    ★
                                </span>
        </div>
        </div>
        <div class="ability-item">
        <label>
                                逻辑思维
                            </label>
        <div class="star-rating" data-target="logic">
        <span class="star" data-value="1">
                                    ★
                                </span>
        <span class="star" data-value="2">
                                    ★
                                </span>
        <span class="star" data-value="3">
                                    ★
                                </span>
        <span class="star" data-value="4">
                                    ★
                                </span>
        <span class="star" data-value="5">
                                    ★
                                </span>
        </div>
        </div>
        <div class="ability-item">
        <label>
                                书面表述
                            </label>
        <div class="star-rating" data-target="writing">
        <span class="star" data-value="1">
                                    ★
                                </span>
        <span class="star" data-value="2">
                                    ★
                                </span>
        <span class="star" data-value="3">
                                    ★
                                </span>
        <span class="star" data-value="4">
                                    ★
                                </span>
        <span class="star" data-value="5">
                                    ★
                                </span>
        </div>
        </div>
        </div>
        <div class="right">
        <canvas height="300" id="abilityChart" style="margin-top: 10px;" width="300">
        </canvas>
        </div>
        </div>
       
        </div>
        <!-- 学习建议 -->
        <h2>学习建议<span class="en-title">LEARNING ADVICE</span></h2>
        <div class="study-block">
        <div class="input-group item1">
        <label>课堂小测准确率</label>
        <input max="100" min="0" placeholder="输入百分比" type="number">
        </input></div>
        <div class="input-group item2">
        <label>薄弱知识点</label>
        <input type="text">
        </input></div>
        <div class="input-group item3">
        <label>学习及备考建议</label>
        <textarea rows="3"></textarea>
        </div>
       
        </div>
        <p>能力评估板块仅为授课教师针对首次课课堂表现给出的评价，可能存在主观性，仅作为后续课程和学习规划参考使用</p>
        
</div>
<footer>
    <div class="footer-header">
        <div class="left-shape"></div>
        <div class="right-shape"></div>
        <div class="footer-content">
            <span class="title-part">DIAGNOSIS REPORT</span><span class="title-part">ON LEARNING SITUATION</span>
        </div>
    </div>
</footer>
   </div>
<script>
        // 星级评分功能
        document.querySelectorAll('.star-rating').forEach(container => {
            const stars = container.querySelectorAll('.star');

            stars.forEach((star, index) => {
                star.addEventListener('click', () => {
                    stars.forEach(s => s.classList.remove('active'));
                    for (let i = 0; i <= index; i++) {
                        stars[i].classList.add('active');
                    }
                    updateHiddenInput(container, index + 1);
                });
            });

            function updateHiddenInput(container, value) {
                let input = container.querySelector('input[type="hidden"]');
                if (!input) {
                    input = document.createElement('input');
                    input.type = 'hidden';
                    input.name = container.dataset.target;
                    container.appendChild(input);
                }
                input.value = value;
            }
        });
    </script>
<script>
        let radarChartInstance = null;

        function getStarRatings() {
            const areas = ["subject-base", "english", "calculation", "flexibility", "logic", "writing"];
            return areas.map(id => {
                const stars = document.querySelectorAll('[data-target="' + id + '"] .star.active');
                return stars.length;
            });
        }

        function drawRadarChart() {
            const ctx = document.getElementById('abilityChart');
            if (!ctx) return;

            const ratings = getStarRatings();

            if (radarChartInstance) {
                radarChartInstance.data.datasets[0].data = ratings;
                radarChartInstance.update();
            } else {
                radarChartInstance = new Chart(ctx, {
                    type: 'radar',
                    data: {
                        labels: ['学科基础', '英文水平', '计算准确', '灵活运用', '逻辑思维', '书面表述'],
                        datasets: [{
                            label: '',
                            data: ratings,
                            fill: true,
                            backgroundColor: 'rgba(0, 90, 84, 0.2)',
                            borderColor: '#abd0e3',
                            pointBackgroundColor: '#abd0e3',
                            pointBorderColor: '#fff',
                            pointHoverBackgroundColor: '#fff',
                            pointHoverBorderColor: '#abd0e3'
                        }]
                    },
                    options: {
                        responsive: false,
                        plugins: {
                            legend: {
                                display: false  // <<< 禁用图例（包括色块和标签）
                            }
                        },
                        scales: {
                            r: {
                                suggestedMin: 0,
                                suggestedMax: 5,
                                ticks: {
                                    display: false
                                }
                            }
                        }
                    }
                });
            }
        }

        document.addEventListener("DOMContentLoaded", drawRadarChart);
        document.querySelectorAll('.star-rating .star').forEach(star => {
            star.addEventListener('click', () => {
                drawRadarChart();
            });
        });
    </script>
<script>
    document.addEventListener("DOMContentLoaded", async () => {
  // ================== 动态加载数据库 ==================
  let systemToSubjects, systemSubjectToPapers, paperInfoMap;
  try {
    const response = await fetch('./database.json');
    const data = await response.json();
    ({ systemToSubjects, systemSubjectToPapers, paperInfoMap } = data);
  } catch (error) {
    alert("数据库加载失败，请检查文件路径或格式");
    return;
  }

  // ================== 获取DOM元素 ==================
  const systemSelect = document.querySelector('.exam-block select:nth-of-type(1)');
  const subjectSelect = document.querySelector('.item1 select');
  const paperSelect = document.querySelector('.item2 select');
  const durationInput = document.querySelector('input[placeholder="分钟"]');
  const fullScoreInput = document.querySelector('.exam-block input[type="number"]');
  const gradeInputs = document.querySelectorAll('.item3 input');

  // ================== 初始化体系选项 ==================
  if (systemSelect) {
    systemSelect.innerHTML = '<option value="">请选择</option>' + 
      Object.keys(systemToSubjects).map(sys => 
        `<option value="${sys}">${sys}</option>`
      ).join('');
  }

  // ================== 体系选择事件 ==================
  systemSelect?.addEventListener('change', () => {
    const system = systemSelect.value;
    const subjects = systemToSubjects[system] || [];
    subjectSelect.innerHTML = '<option value="">请选择</option>' +
      subjects.map(sub => `<option value="${sub}">${sub}</option>`).join('');
    paperSelect.innerHTML = '<option value="">请选择</option>';
    clearInputs();
  });

  // ================== 学科选择事件 ==================
  subjectSelect?.addEventListener('change', () => {
    const system = systemSelect.value;
    const subject = subjectSelect.value;
    const key = `${system}__${subject}`;
    const papers = systemSubjectToPapers[key] || [];
    paperSelect.innerHTML = '<option value="">请选择</option>' +
      papers.map(p => `<option value="${p}">${p}</option>`).join('');
    clearInputs();
  });

  // ================== 试卷选择事件 ==================
  paperSelect?.addEventListener('change', () => {
    const system = systemSelect.value;
    const subject = subjectSelect.value;
    const paper = paperSelect.value;
    const key = `${system}__${subject}__${paper}`;
    const paperInfo = paperInfoMap[key] || {};

    durationInput.value = paperInfo.duration || '';
    fullScoreInput.value = paperInfo.full_score || '';

    if (paperInfo.grades && paperInfo.gradeLabels) {
      const isAP = system.includes('AP');
      paperInfo.gradeLabels.forEach((label, index) => {
        const grade = paperInfo.grades[index] ?? '-';
        const displayLabel = isAP ? label : 
          label.replace('5', 'A*').replace('4', 'A')
               .replace('3', 'B').replace('2', 'C').replace('1', 'D');
        gradeInputs[index].value = `[${displayLabel}] ${grade}`;
      });
    }
  });

  // ================== 工具函数 ==================
  function clearInputs() {
    durationInput.value = '';
    fullScoreInput.value = '';
    gradeInputs.forEach(input => input.value = '');
  }
});
    </script>
</script>




<!-- 引入 html2canvas -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script>
function exportToImage(format = 'png') {
    const exportBtn = document.querySelector('button');
    exportBtn.style.display = 'none'; // 隐藏按钮

    const nameInput = document.querySelectorAll('.base-block input')[0];
    const studentName = nameInput.value || "未命名";

    const element = document.body;

    html2canvas(element, {
        scale: 3,
        useCORS: true,
        allowTaint: true,
        width: 794, // A4 宽度
        windowWidth: 794
    }).then(canvas => {
        const link = document.createElement("a");
        link.download = `${studentName}-首次课学情诊断单.${format}`;
        link.href = canvas.toDataURL(`image/${format}`);
        link.click();
        exportBtn.style.display = 'block'; // 恢复按钮显示
    });
}
</script>
</body>

</html>
